<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebRSS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//netdna.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css" rel="stylesheet" />
    <link href="//netdna.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="{{ url_for('static', filename='default.css') }}" rel="stylesheet" />
    <script>
        var webrss = webrss || {};
        webrss.url = webrss.url || {};

        webrss.url.feed_index = "{{ url_for('feed.index') }}";
        webrss.url.feed_create = "{{ url_for('feed.create') }}";
        webrss.url.feed_update = "{{ url_for('feed.update') }}";
        webrss.url.feed_delete = "{{ url_for('feed.delete') }}";

        webrss.url.category_index = "{{ url_for('category.index') }}";
        webrss.url.category_create = "{{ url_for('category.create') }}";
        webrss.url.category_update = "{{ url_for('category.update') }}";
        webrss.url.category_delete = "{{ url_for('category.delete') }}";

        webrss.url.entry_fetch = "{{ url_for('entry.fetch') }}";
    </script>
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
    <![endif]-->

    <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/latest/js/bootstrap.min.js"></script>

    {% if google_site_verification %}<meta name="google-site-verification" content="{{ google_site_verification }}" />{% endif %}
</head>
<body>

    <div id="wrap">
        <header class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">WebRSS</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <!--<li><a href="/">Add</a></li>-->

                        <li><button class="btn btn-primary btn-sl" data-toggle="modal" data-target="#add-category"><i class="glyphicon glyphicon-plus"></i> Add category</button></li>
                        <li><button class="btn btn-primary btn-sl" id="feed-form-create"><i class="glyphicon glyphicon-plus"></i> Add feed</button></li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <form class="navbar-form navbar-left search" role="search">
                                <div class="form-group"><input name="phrase" type="text" class="form-control" placeholder="Search" /></div>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </header>

        <div class="row" id="rss">
            <div class="col-md-3" id="channels">
                {% for category in categories %}
                <h4>
                    {{ category.title }}
                    <!--<span class="pull-right">-->
                        <!--<div class="dropdown">-->
                            <!--<a data-toggle="dropdown" href="#" class="glyphicon glyphicon-cog" data-category-id="{{ category.id }}"></a>-->
                            <!--<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">-->
                                <!--<li><i class="glyphicon glyphicon-plus" data-category-id="{{ category.id }}"></i> Add in this category</li>-->
                            <!--</ul>-->
                        <!--</div>-->
                    <!--</span>-->

                    <span class="pull-right">
                        <!--<i href="#" class="glyphicon glyphicon-trash pointer" data-category-id="{{ category.id }}" title="Delete this category"></i>-->
                        <i class="glyphicon glyphicon-plus pointer" data-category-id="{{ category.id }}" title="Add feed in this category"></i>
                    </span>
                </h4>
                <ul class="nav nav-pills nav-stacked resource-list">
                    {% for feed in category.not_deleted_feeds() %}
                    <li class="feed">
                        <a href="#" class="feed-link" data-feed-id="{{ feed.id }}"><img class="favicon-url" src="{{ feed.site_favicon_url }}">
                            <span class="feed-title">{{ feed.feed_title }}</span>
                            <span class="pull-right">
                                <span class="badge">{{ feed.count_un_read() }}</span>
                                &nbsp;<i class="glyphicon glyphicon-trash pointer" data-feed-id="{{ feed.id }}" title="Delete this feed"></i>
                                &nbsp;<i class="glyphicon glyphicon-edit pointer" data-feed-id="{{ feed.id }}" title="Edit this feed"></i>
                                <!--&nbsp;&nbsp; <i class="glyphicon glyphicon-edit"></i>-->
                            </span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {% endfor %}
            </div>
            <div class="col-md-9" id="feeds">
                <div id="list">
                    <!--//-->
                </div>
                <div id="content">
                    <!--//-->
                </div>
            </div>
        </div>

        <footer id="footer">&copy; 2014 <a href="http://danielczuba.pl" title="Daniel Alkemic Czuba">Daniel Czuba</a></footer>

    </div><!-- /#wrap -->

    {% include 'category/forms.html' with context %}
    {% include 'feed/forms.html' with context %}

    <script>
        $(document).ready(function(){
            var div_channels = $('div#channels'),
                entries_list = $('#feeds div#list'),
                entry_content = $('#feeds div#content'),
                feed_row = $('tbody tr', entries_list);

            // loading feed content
            $('#channels ul li a').click(function(e){
                e.preventDefault();
                var feed_id = $(this).data('feed-id');
                $.post(webrss.url.feed_index, {feed_id: feed_id}, function(res){
                    entries_list.html(res);
                });
            });

            // reading new feed
            entries_list.on('click', 'tr[data-entry-id]', function(e){
                e.preventDefault();

                var self = $(this),
                    entry_id = self.data('entry-id'),
                    entry_feed_id = self.data('feed-id');

                $.post(webrss.url.entry_fetch, {pk: entry_id}, function(content){
                    entry_content.html(content);
                    if(self.hasClass('bold')){
                        var feed_badge = $('a[data-feed-id='+entry_feed_id+'].feed-link span.badge');
                        feed_badge.html(feed_badge.html()-1);
                        self.removeClass('bold');
                    }
                });
            });

        });
    </script>

</body>
</html>
